<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RExSyn API Console (Light)</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { color-scheme: dark; }
    body { font-family: 'Inter', system-ui, sans-serif; background:#0f1720; color:#e7eef7; }
    .panel { background:#121c28; border:1px solid #1f2b3a; border-radius:12px; }
    .badge { border:1px solid #1f2b3a; padding:6px 10px; border-radius:999px; color:#9ab0c8; font-size:12px; }
    textarea, input { background:#0f1823; border:1px solid #1f2b3a; color:#e7eef7; }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-5xl mx-auto px-4 py-8 space-y-8">
    <header class="space-y-3">
      <div class="flex gap-2 flex-wrap">
        <span class="badge">Light Demo</span>
        <span class="badge">/predict → /status → /result</span>
      </div>
      <h1 class="text-3xl md:text-4xl font-extrabold">API Console (Light Mode)</h1>
      <p class="text-slate-300 text-sm md:text-base max-w-3xl">
        Enter a token and call predict → status → result. In light mode the placeholder pipeline responds immediately with no external executors.
      </p>
    </header>

    <section class="panel p-4 space-y-4">
      <div class="grid md:grid-cols-2 gap-3">
        <div class="space-y-2">
          <label class="text-sm text-slate-300">Bearer Token</label>
          <input id="token" class="w-full rounded-md px-3 py-2" placeholder="demo token" />
        </div>
        <div class="space-y-2">
          <label class="text-sm text-slate-300">API Base URL</label>
          <input id="base" class="w-full rounded-md px-3 py-2" />
        </div>
      </div>
      <div class="space-y-2">
        <label class="text-sm text-slate-300">Predict Body (JSON)</label>
        <textarea id="body" rows="4" class="w-full rounded-md px-3 py-2">{"sequence":"ACDEFGHIKLMNPQRSTVWY","experiment_type":"protein_folding","method":"alphafold3"}</textarea>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button id="btnPredict" class="bg-emerald-400 hover:bg-emerald-300 text-slate-900 font-semibold px-4 py-2 rounded-md">/predict</button>
        <button id="btnStatus" class="bg-slate-800 hover:bg-slate-700 text-slate-100 font-semibold px-4 py-2 rounded-md">/status</button>
        <button id="btnResult" class="bg-slate-800 hover:bg-slate-700 text-slate-100 font-semibold px-4 py-2 rounded-md">/result</button>
        <span class="text-sm text-slate-400">job_id: <span id="jobId" class="text-emerald-300"></span></span>
      </div>
      <div class="space-y-2">
        <label class="text-sm text-slate-300">Response</label>
        <pre id="output" class="bg-[#0b111b] border border-[#1f2b3a] rounded-md p-3 text-xs text-slate-200 whitespace-pre-wrap">...</pre>
      </div>
    </section>
  </div>

  <script>
    async function callApi(path, options = {}) {
      const base = document.getElementById('base').value.trim() || window.location.origin;
      const token = document.getElementById('token').value.trim();
      const headers = Object.assign({
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : ''
      }, options.headers || {});
      const res = await fetch(`${base}${path}`, { ...options, headers });
      const text = await res.text();
      try { return { status: res.status, body: JSON.parse(text) }; }
      catch { return { status: res.status, body: text }; }
    }

    function setOutput(data) {
      const el = document.getElementById('output');
      el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }

    document.getElementById('btnPredict').onclick = async () => {
      try {
        const bodyText = document.getElementById('body').value;
        const result = await callApi('/api/v1/predict', { method: 'POST', body: bodyText });
        setOutput(result);
        if (result.body && result.body.job_id) {
          document.getElementById('jobId').textContent = result.body.job_id;
        }
      } catch (e) { setOutput(e.toString()); }
    };

    document.getElementById('btnStatus').onclick = async () => {
      const jobId = document.getElementById('jobId').textContent.trim();
      if (!jobId) return setOutput('No job_id. Call /predict first.');
      const result = await callApi(`/api/v1/jobs/${jobId}/status`);
      setOutput(result);
    };

    document.getElementById('btnResult').onclick = async () => {
      const jobId = document.getElementById('jobId').textContent.trim();
      if (!jobId) return setOutput('No job_id. Call /predict first.');
      const result = await callApi(`/api/v1/jobs/${jobId}/result`);
      setOutput(result);
    };

    // init defaults
    document.getElementById('base').value = window.location.origin;
    document.getElementById('token').value = "<demo-token>"; // replace with your demo token
  </script>
</body>
</html>
